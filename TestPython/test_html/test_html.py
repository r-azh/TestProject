import json

data = {
    "text": "\u2026 _ **\u2b55 \ufe0f**_\u0645\u0639\u0635\u0648\u0645\u0647 \u0622\u0642\u0627\u067e\u0648\u0631\u0639\u0644\u06cc\u0634\u0627\u0647\u06cc \u062f\u0631 \u06af\u0641\u062a\u200c\u0648\u06af\u0648 \u0628\u0627 \u062e\u0628\u0631\u0646\u06af\u0627\u0631 \u062e\u0628\u0631\u06af\u0632\u0627\u0631\u06cc \u062e\u0627\u0646\u0647 \u0645\u0644\u062a\u060c \u0628\u0627 \u0627\u0634\u0627\u0631 \u0628\u0647 \u0628\u062e\u0634\u0646\u0627\u0645\u0647 \u062c\u062f\u06cc\u062f \u0628\u0627\u0646\u06a9 \u0645\u0631\u06a9\u0632\u06cc \u0628\u0631\u0627\u06cc \u062f\u0631\u06cc\u0627\u0641\u062a \u0645\u0627\u0644\u06cc\u0627\u062a \u0627\u0632 \u062e\u0631\u06cc\u062f\u0627\u0631\u0627\u0646 \u0628\u06cc\u0634 \u0627\u0632 \u06f2\u06f5 \u0633\u06a9\u0647 \u0627\u0638\u0647\u0627\u0631 \u062f\u0627\u0634\u062a: \u062f\u0631 \u0634\u0631\u0627\u06cc\u0637 \u0641\u0639\u0644\u06cc \u062f\u0631\u06cc\u0627\u0641\u062a \u0645\u0627\u0644\u06cc\u0627\u062a \u0627\u0632 \u0633\u06a9\u0647 \u0645\u0646\u0627\u0633\u0628 \u0646\u06cc\u0633\u062a\u060c \u0645\u0634\u06a9\u0644 \u06a9\u0646\u0648\u0646\u06cc \u06a9\u0634\u0648\u0631 \u0627\u0641\u0632\u0627\u06cc\u0634 \u062d\u062c\u0645 \u0646\u0642\u062f\u06cc\u0646\u06af\u06cc \u0627\u0633\u062a\u060c \u0647\u0631 \u0686\u0642\u062f\u0631 \u0645\u0631\u062f\u0645 \u0631\u0627 \u0628\u0631\u0627\u06cc \u062e\u0631\u06cc\u062f \u062a\u062d\u062a \u0641\u0634\u0627\u0631 \u0642\u0631\u0627\u0631 \u062f\u0647\u06cc\u0645 \u0628\u0627\u0639\u062b \u0645\u06cc \u0634\u0648\u062f \u062d\u062c\u0645 \u0646\u0642\u062f\u06cc\u0646\u06af\u06cc \u0627\u0632 \u0633\u06a9\u0647 \u0628\u0647 \u0633\u0645\u062a \u0628\u0627\u0632\u0627\u0631 \u0627\u0631\u0632 \u0645\u06cc \u0631\u0648\u062f\u060c \u0627\u0631\u0632 \u0631\u0627 \u0645\u062d\u062f\u0648\u062f \u06a9\u0646\u06cc\u0645 \u0646\u0642\u062f\u06cc\u0646\u06af\u06cc \u0628\u0647 \u0633\u0645\u062a \u062e\u0648\u062f\u0631\u0648 \u0633\u0631\u0627\u0632\u06cc\u0631 \u0645\u06cc \u0634\u0648\u062f \u0648 \u0628\u0639\u062f \u0627\u0632 \u0622\u0646 \u0628\u0647 \u0633\u0645\u062a \u0645\u0633\u06a9\u0646 \u0645\u06cc \u0631\u0648\u062f\u060c \u062f\u0631\u06cc\u0627\u0641\u062a \u0645\u0627\u0644\u06cc\u0627\u062a \u0631\u0627\u0647 \u062d\u0644 \u0647\u062f\u0627\u06cc\u062a \u062d\u062c\u0645 \u0646\u0642\u062f\u06cc\u0646\u06af\u06cc \u0646\u06cc\u0633\u062a. _**\u2b55 \ufe0f**_\u0639\u0636\u0648 \u0647\u06cc\u0627\u062a \u0631\u06cc\u06cc\u0633\u0647 \u06a9\u0645\u06cc\u0633\u06cc\u0648\u0646 \u0627\u0642\u062a\u0635\u0627\u062f\u06cc \u0645\u062c\u0644\u0633 \u0627\u062f\u0627\u0645\u0647 \u062f\u0627\u062f: \u0645\u0647\u0645\u062a\u0631\u06cc\u0646 \u0631\u0627\u0647 \u062d\u0644 \u0647\u0645\u0627\u0647\u0646\u06af\u06cc \u0648 \u06a9\u0646\u062a\u0631\u0644 \u062d\u062c\u0645 \u0646\u0642\u062f\u06cc\u0646\u06af\u06cc \u062f\u0631 \u0645\u0631\u062d\u0644\u0647 \u0627\u0648\u0644 \u0627\u06cc\u0646 \u0627\u0633\u062a \u06a9\u0647 \u0628\u0647 \u0628\u062e\u0634 \u062e\u0635\u0648\u0635\u06cc \u0627\u0639\u062a\u0645\u0627\u062f \u06a9\u0646\u06cc\u0645 \u0648 \u062f\u0633\u062a \u0627\u0632 \u0633\u062e\u062a \u06af\u06cc\u0631\u06cc \u0647\u0627 \u0628\u0631\u062f\u0627\u0631\u06cc\u0645\u060c \u0645\u062d\u06cc\u0637 \u06a9\u0633\u0628 \u0648 \u06a9\u0627\u0631 \u0631\u0627 \u0631\u0627\u062d\u062a \u06a9\u0646\u06cc\u0645\u060c \u062a\u0631\u062e\u06cc\u0635 \u06a9\u0627\u0644\u0627\u0647\u0627 \u062a\u0633\u0647\u06cc\u0644 \u0634\u0648\u062f.\u2026",
    "highlights": [{"keyword": "\u0628\u062e\u0634 \u062e\u0635\u0648\u0635\u06cc", "type": "keyword_main", "offset": 610, "length": 9}]
}

print(len(data['text']))


def tag_highlights_in_text(input):
    # input = json.loads(input)
    text = input['text']
    highlights = input['highlights']

    marked_text_array = []
    marked_text = text
    actual_start = 0

    for h in highlights:
        start = h['offset'] - actual_start
        part_one = marked_text[0:start]
        part_two = marked_text[start: start + h['length']]
        marked_text = marked_text[start + h['length']:]
        actual_start = len(text) - len(marked_text)
        style_class = h['type']
        marked_text_array.append(f'{part_one}<b class="{style_class}">{part_two}</b>')
    marked_text_array.append(marked_text)
    return ''.join(marked_text_array)


highlited_text = tag_highlights_in_text(data)

html =	'''
<!DOCTYPE html>
<html>
<head lang="fa-IR">
    <meta charset="UTF-8">
    <title></title>
</head>
<body >
    <p dir="rtl"></p>
    <ul dir="rtl">
        {{ highlited_text }}
    </ul>
</body>
</html>
'''

from jinja2 import Template

template = Template(html)
result = template.render(highlited_text=highlited_text)

with open('result.html', 'w') as output:
    output.write(result)


text = 'یک شهر پر از آدم و این حجم پر از درد لعنت شود آن شب که تو را برد و نیاورد ... _ **✍ 🏼**_ #مهتاب_بهشتی _ **🔸 ️**_ #كافه_كتاب _**☕ ️**_ _ **📚**_ [@CafeKetab_Channe](https://t.me/CafeKetab_Channe) '
print(text)
